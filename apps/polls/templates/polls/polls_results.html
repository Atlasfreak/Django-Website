{% extends 'polls/polls_base.html' %}

{% block title %}{{poll.title}} - Ergebnisse{% endblock %}
{% block brand %}{{poll.title}} - Ergebnisse{% endblock %}
{% block content %}
    <div class="rounded-lg p-3 bg-white shadow my-4">
        <p><a href={% url 'polls:csv' token=poll.token %} target="_blank">CSV herunterladen</a></p>
        <div class="d-flex">
            <div class="h1">{{poll.title}}</div>
            <div class="ml-auto align-self-center h4">Ersteller: {% if poll.creator.full_name %}{{poll.creator.full_name}}{% else %}{{poll.creator.username}}{% endif %}</div>
        </div>
        <hr>
        <section class = "mt-3">
            <p class="text-break">{{poll.info_text|urlize|linebreaks}}</p>
        </section>
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">Einsenedatum</th>
                        {% for question in poll.questions.all %}
                            <th scope="col">{{question.text}}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for submission in poll.submissions.all %}
                        <tr>
                            <th scope="row">{{submission.submission_date}}</th>
                            {% for question in poll.questions.all %}
                                <td>
                                    {% for answer in question.answers.all %}
                                        {% if answer.submission == submission %}
                                            {% if question.type.enable_choices %}
                                                {% for choice in answer.choices.all %}
                                                    {{choice.text}}
                                                {% endfor %}
                                            {% else %}
                                                {{answer.value}}
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock content %}